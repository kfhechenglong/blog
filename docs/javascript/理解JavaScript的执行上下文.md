# 理解JavaScript的执行上下文

作为一个前端开发者，你必须知道`JavaScript`程序内部是如何执行的，尤其是理解`JavaScript`的执行上下文和执行栈，这对后面理解`JavaScript`中的闭包、作用域链等等有着至关的作用；

## 什么是执行上下文

执行上下文：指当前执行环境中的变量、函数声明，参数（arguments），作用域链，this等信息。

简而言之，执行上下文是评估和执行 `JavaScript` 代码的环境的抽象概念。每当 `Javascript` 代码在运行的时候，它都是在执行上下文中运行。

## 执行上下文的类型

`JavaScript`中有三种执行上下文类型。
可以分为：
- 全局执行上下文
  
  全局执行上下文，在浏览器环境下一般指的是`window`，并且设置`this`的值会指向这个全局的上下文对象，一个程序中只有一个全局上下文。

- 函数执行上下文

  函数被调用时，都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，并且该上下文都是在函数函数调用时创建的。

- Eval 函数执行上下文

  由于`Eval`函数一般很少使用，我们这里就不在讨论。


## 上下文的执行栈

当 `JavaScript` 引擎第一次遇到你的脚本时，它会创建一个全局的执行上下文并且压入当前执行栈。每当引擎遇到一个函数调用，它会为该函数创建一个新的执行上下文并压入栈的顶部。

执行栈会执行位与栈顶的函数，当位于栈顶的函数执行完毕后，就从栈顶弹出该函数（即出栈），然后继续执行下一个位于栈顶的函数，直至执行栈内的函数执行完毕。

理解如下示例代码：

<<< ./docs/javascript/examples/js-stack.js

上述代码在浏览器引擎执行时

首选创建了一个全局执行上下文，并将全局执行上下文压入当前的执行栈中。

当程序执行遇到`first()`函数调用时，`JavaScript`引擎为该函数创建一个新的执行上下文并把它压入当前执行栈的顶部。

当从 `first()` 函数内部调用 `second()` 函数时，`JavaScript`引擎为 `second()` 函数创建了一个新的执行上下文并把它压入当前执行栈的顶部。

当 `second()` 函数执行完毕，它的执行上下文会从当前栈弹出，并且控制流程到达下一个执行上下文，即 `first()`函数的执行上下文。

当 `first()`执行完毕，它的执行上下文从栈弹出，控制流程到达全局执行上下文。

一旦所有代码执行完毕，`JavaScript`引擎从当前栈中移除全局执行上下文。